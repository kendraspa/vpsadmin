#!/bin/bash
. /etc/vz/vz.conf
. ${VE_CONFFILE}

<% @mounts.reverse.each do |mnt| %>
  <% if mnt['type'] == 'dataset_local' || mnt['type'] == 'dataset_remote' %>
    DST="<%= mnt['dst'] %>"
    if grep ${VE_ROOT}${DST} /proc/mounts; then umount <%= mnt['umount_opts'] %> ${VE_ROOT}${DST}; fi

  <% elsif mnt['type'] == 'snapshot_local' || mnt['type'] == 'snapshot_remote' %>
    DST="<%= mnt['dst'] %>"
    if grep ${VE_ROOT}${DST} /proc/mounts; then umount <%= mnt['umount_opts'] %> ${VE_ROOT}${DST}; fi

  <% else %>
    # Unknown mount type '<%= mnt['type'] %>
  <% end %>
<% end %>

exit 0
